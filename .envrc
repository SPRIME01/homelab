# Auto-activate mise for the current shell
if command -v mise >/dev/null 2>&1; then
  if [ -n "$BASH_VERSION" ]; then
    eval "$(mise activate bash)"
  elif [ -n "$ZSH_VERSION" ]; then
    eval "$(mise activate zsh)"
  else
    # Fallback to POSIX sh activation
    eval "$(mise activate bash || true)"
  fi
fi

# Devbox availability shim (safe, non-destructive)
# Devbox is not auto-entered here. Run `devbox shell` manually when you want an interactive devbox.
if command -v devbox >/dev/null 2>&1; then
  export DEVBOX_AVAILABLE=1
  devbox-shell() {
    # Explicit interactive entry; does not run automatically on direnv load
    command devbox shell "$@"
  }
  alias devbox-shell=devbox-shell
fi

# Auto-detect homelab environment based on the presence of the SOPS/age key
# Do not override the variable if the user has explicitly set `HOMELAB`.
if [ -z "${HOMELAB-}" ]; then
  if [ -f "$HOME/.config/sops/age/keys.txt" ]; then
    export HOMELAB=1
  else
    export HOMELAB=0
  fi
fi
